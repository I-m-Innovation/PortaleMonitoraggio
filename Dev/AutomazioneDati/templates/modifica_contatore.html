{% extends 'base_layout.html' %}
{% load static %}

{% block title %}Modifica Contatore - {{ contatore.nome }}{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/form.css' %}">
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Modifica Dati Contatore: {{ contatore.nome }}</h5>
                </div>
                <div class="card-body">
                    <form action="{% url 'modifica_contatore' contatore.id %}" method="post">
                        {% csrf_token %}
                        <input type="hidden" name="impianto_id" value="{{ impianto.id }}">
                        
                        <div class="mb-3">
                            <label for="nome" class="form-label">Nome Contatore</label>
                            <input type="text" class="form-control" id="nome" name="nome" value="{{ contatore.nome }}" required>
                        </div>
                        <div class="mb-3">
                            <label for="pod" class="form-label">POD</label>
                            <input type="text" class="form-control" id="pod" name="pod" value="{{ contatore.pod }}" required>
                        </div>
                        <div class="mb-3">
                            <label for="tipologia" class="form-label">Tipologia</label>
                            <select class="form-select" id="tipologia" name="tipologia" required>
                                {% for choice_value, choice_label in contatore.TIPOLOGIA_CHOICES %}
                                    <option value="{{ choice_value }}" {% if contatore.tipologia == choice_value %}selected{% endif %}>{{ choice_label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="tipologiafascio" class="form-label">Tipologia Fascio</label>
                            <select class="form-select" id="tipologiafascio" name="tipologiafascio" required>
                                {% for choice_value, choice_label in contatore.TIPOLOGIAFASCIO_CHOICES %}
                                    <option value="{{ choice_value }}" {% if contatore.tipologiafascio == choice_value %}selected{% endif %}>{{ choice_label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="matricola" class="form-label">Matricola</label>
                            <input type="text" class="form-control" id="matricola" name="matricola" value="{{ contatore.matricola }}">
                        </div>
                        <div class="mb-3">
                            <label for="k" class="form-label">K</label>
                            <input type="number" class="form-control" id="k" name="k" value="{{ contatore.k }}" required>
                        </div>
                        <div class="mb-3">
                            <label for="marca" class="form-label">Marca</label>
                            <select class="form-select" id="marca" name="marca">
                                <option value="" {% if not contatore.marca %}selected{% endif %}>Seleziona marca</option>
                            </select>
                            
                        </div>
                        <div class="mb-3">
                            <label for="modello" class="form-label">Modello</label>
                            <input type="text" class="form-control" id="modello" name="modello" value="{{ contatore.modello }}" required>
                        </div>
                        <div class="mb-3">
                            <label for="data_installazione" class="form-label">Data Installazione</label>
                            <input type="date" class="form-control" id="data_installazione" name="data_installazione" value="{{ contatore.data_installazione|date:'Y-m-d' }}" required>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Salva Modifiche</button>
                        <a href="{% url 'panoramica-contatore' nickname=contatore.impianto_nickname %}" class="btn btn-secondary">Annulla</a>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const marcaSelect = document.getElementById('marca');
        const marcaAltroInput = document.getElementById('marca-altro');

        function toggleMarcaAltro() {
            if (marcaSelect.value === 'Altro') {
                marcaAltroInput.style.display = 'block';
                marcaAltroInput.setAttribute('required', 'true');
            } else {
                marcaAltroInput.style.display = 'none';
                marcaAltroInput.removeAttribute('required');
                marcaAltroInput.value = ''; // Clear value when hidden
            }
        }

        marcaSelect.addEventListener('change', toggleMarcaAltro);

        // Initial call to set visibility based on initial selection
        toggleMarcaAltro();
    });
</script>
{% endblock %} 